Ext.define("NLeSC.form.field.Time",{override:"Ext.form.field.Time",initDate:"1/1/20080",initDateFormat:"j/n/YZ"});Ext.define("NLeSC.picker.Time",{override:"Ext.picker.Time",normalizeDate:function(a){return a}});Ext.define("NLeSC.form.field.DateTime",{extend:Ext.form.FieldContainer,mixins:{field:Ext.form.field.Field},alias:"widget.xdatetime",combineErrors:false,msgTarget:"under",layout:"hbox",readOnly:false,dateFormat:"Y-m-d",timeFormat:"H:i:s",dateTimeFormat:"c",labelAttrTpl:'data-qtip="Date time in UTC timezone"',dateConfig:{},timeConfig:{},dateValue:null,dateField:null,timeField:null,initComponent:function(){var b=this;b.items=b.items||[];this.forceUtcFormat();b.dateField=Ext.create("Ext.form.field.Date",Ext.apply({format:b.dateFormat,flex:1,allowBlank:b.allowBlank,reset:Ext.emptyFn,getSubmitData:function(){return null},getModelData:function(){return null},submitValue:false},b.dateConfig));b.items.push(b.dateField);b.timeField=Ext.create("Ext.form.field.Time",Ext.apply({format:b.timeFormat,flex:1,allowBlank:b.allowBlank,reset:Ext.emptyFn,getSubmitData:function(){return null},getModelData:function(){return null},submitValue:false},b.timeConfig));b.items.push(b.timeField);for(var a=0;a<b.items.length;a++){b.items[a].on("focus",Ext.bind(b.onItemFocus,b));b.items[a].on("blur",Ext.bind(b.onItemBlur,b));b.items[a].on("specialkey",function(f,e){var c=e.getKey(),d=c==e.TAB;if(d&&b.focussedItem==b.dateField){e.stopEvent();b.timeField.focus();return}b.fireEvent("specialkey",f,e)})}Ext.apply(Ext.form.field.VTypes,{daterange:function(f,e){var d=f;if(!d){return false}if(e.startDateField&&(!this.dateRangeMax||(d.getTime()!=this.dateRangeMax.getTime()))){var g=e.up("form").down("#"+e.startDateField);g.setMaxValue(d);this.dateRangeMax=d}else{if(e.endDateField&&(!this.dateRangeMin||(d.getTime()!=this.dateRangeMin.getTime()))){var c=e.up("form").down("#"+e.endDateField);c.setMinValue(d);this.dateRangeMin=d}}return true},daterangeText:"Start date must be less than end date"});b.callParent();b.initField()},forceUtcFormat:function(){Ext.Date.formatCodes.Y="Ext.String.leftPad(this.getUTCFullYear(), 4, '0')";Ext.Date.formatCodes.m="Ext.String.leftPad(this.getUTCMonth() + 1, 2, '0')";Ext.Date.formatCodes.d="Ext.String.leftPad(this.getUTCDate(), 2, '0')";Ext.Date.formatCodes.H="Ext.String.leftPad(this.getUTCHours(), 2, '0')";Ext.Date.formatCodes.i="Ext.String.leftPad(this.getUTCMinutes(), 2, '0')";Ext.Date.formatCodes.s="Ext.String.leftPad(this.getUTCSeconds(), 2, '0')";Ext.Date.formatCodes.c="this.toISOString()";Ext.Date.clearTime=function(a,b){if(b){return Ext.Date.clearTime(Ext.Date.clone(a))}a.setUTCHours(0);a.setUTCMinutes(0);a.setUTCSeconds(0);a.setUTCMilliseconds(0);return a};Ext.JSON.encodeDate=function(a){return'"'+a.toISOString()+'"'}},focus:function(){this.callParent();this.dateField.focus()},onItemFocus:function(a){if(this.blurTask){this.blurTask.cancel()}this.focussedItem=a},onItemBlur:function(b){var a=this;if(b!=a.focussedItem){return}a.blurTask=new Ext.util.DelayedTask(function(){a.fireEvent("blur",a)});a.syncValue();a.blurTask.delay(100)},getValue:function(){var a=this.dateField.getValue();var b=this.timeField.getValue();if(a&&b){a.setUTCHours(b.getUTCHours());a.setUTCMinutes(b.getUTCMinutes());a.setUTCSeconds(b.getUTCSeconds())}return a},getSubmitValue:function(){var a=this.getValue();return a?Ext.Date.format(a,this.dateTimeFormat):null},syncValue:function(){var a=this;a.mixins.field.setValue.call(a,a.getValue())},setValue:function(a){if(Ext.isString(a)){a=Ext.Date.parse(a,this.dateTimeFormat)}this.dateField.setValue(a);this.timeField.setValue(a);this.syncValue()},getFormat:function(){return(this.dateField.submitFormat||this.dateField.format)+"T"+(this.timeField.submitFormat||this.timeField.format)},getSubmitData:function(){var a=this,b=null;if(!a.disabled&&a.submitValue&&!a.isFileUpload()){b={};b[a.getName()]=""+a.getSubmitValue()}return b},setMaxValue:function(a){this.dateField.setMaxValue(a)},setMinValue:function(a){this.dateField.setMinValue(a)},getErrors:function(b){var a=this;var e=[];var d=a.vtype;var c=Ext.form.field.VTypes;b=b||a.getValue();e=e.concat(this.dateField.getErrors());e=e.concat(this.timeField.getErrors());if(d){if(!c[d](b,a)){e.push(a.vtypeText||c[d+"Text"])}}return e}});Ext.define("NLeSC.form.field.DateTimeRange",{extend:Ext.form.FieldContainer,alias:"widget.datetimerange",layout:"vbox",defaultType:"xdatetime",defaults:{allowBlank:false},items:[{fieldLabel:"Start",value:new Date(new Date().setUTCHours(0,0,0,0)-(1000*60*60*24*3)),name:"start"},{fieldLabel:"End",value:new Date(new Date().setUTCHours(0,0,0,0)),name:"end"}],getStartField:function(){return this.items.getAt(0)},getEndField:function(){return this.items.getAt(1)},afterComponentLayout:function(){var b=this.getStartField();var a=this.getEndField();this.setMinEnd(b,b.getValue());b.on("change",this.setMinEnd,this);this.setMaxStart(a,a.getValue());a.on("change",this.setMaxStart,this)},setMinEnd:function(b,c){var a=this.getEndField();a.setMinValue(c)},setMaxStart:function(a,c){var b=this.getStartField();b.setMaxValue(c)}});